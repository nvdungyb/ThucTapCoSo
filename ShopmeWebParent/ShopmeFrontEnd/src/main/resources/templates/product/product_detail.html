<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragment :: page_head('Shopme - Shopme Admin')"/>
<meta charset="ISO-8859-1">
<title>Welcome to Shopme</title>
</head>

<body>
<div class="container-fluid">
    <div th:replace="navigation :: header_menu"></div>
    <div>
        <h1>Product in Category</h1>
    </div>

    <div th:if="${listCategoryParents != null && !listCategoryParents.isEmpty()}">
        <div class="row">
            <div class="col">
                <nav>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a th:href="@{/}">Home</a>
                        </li>
                        <th:block th:each="category : ${listCategoryParents}">
                            <li class="breadcrumb-item">
                                <a th:href="@{/c/{alias}(alias=${category.alias})}" th:text="${category.name}"></a>
                            </li>
                        </th:block>
                        <li class="breadcrumb-item" th:if="${product != null}">
                            <span>[[${product.name}]]</span>
                        </li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm">
            <div>
                <img th:src="@{${product.mainImagePath}}" class="img-fluid"/>
            </div>
        </div>

        <div class="col-sm">
            <div>
                <h2>[[${product.name}]]</h2>
            </div>
            <div>
                <span>Brand: [[${product.brand.name}]]</span>
            </div>
            <div>
                <span>$ [[${product.price}]]</span>
            </div>
            <div>&nbsp;</div>
            <div th:utext="${product.shortDescription}">
            </div>
        </div>

        <div class="col-sm-2">
            <div>
                <span th:if="${product.inStock}" class="text-success"> <b>In Stock</b> </span>
                <span th:unless="${product.inStock}" class="text-danger"> <b>Out of Stock</b> </span>
            </div>
            <div class="mt-2">
                <input type="text" size="5" value="1" id="quantity"/>
            </div>
            <div class="mt-3">
                <input type="button" value="Add to Cart" id="buttonAdd2Cart" class="btn btn-primary"/>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="rol-12">
            <div>
                <hr/>
            </div>
            <div>
                <h3>Product short description</h3>
            </div>
            <div th:utext="${product.shortDescription}">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="rol-12">
            <div>
                <hr/>
            </div>
            <div>
                <h3>Product full description</h3>
            </div>
            <div th:utext="${product.fullDescription}">
            </div>
        </div>
    </div>


    <div th:replace="fragment :: footer_menu"/>
</div>

<script>
    const productId = "[[${product.id}]]";

    $(document).ready(function () {
        $("#buttonAdd2Cart").on("click", function () {
            const quantity = $("#quantity").val();
            addToCart(productId, quantity);
        });
    });

    function addToCart(productId, quantity) {
        $.ajax({
            type: "POST",
            url: `/Shopme/cart/add/${productId}/${quantity}`,
            success: function (response) {
                alert("Product added to cart successfully!");
            },
            error: function (error) {
                if (error.status === 401) {
                    alert("You must login to add product to cart!");
                    window.location.href = "/Shopme/login";  // Redirect to login page
                } else {
                    alert("Failed to add product to cart!");
                }
            }
        });
    }
</script>

</body>
</html>